<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Joon Song — Portfolio</title>
    <meta name="description" content="Engineer & builder. Machine learning, systems, and quant crypto trading." />
    <meta property="og:title" content="Joon Song — Portfolio" />
    <meta property="og:description" content="Engineer & builder. Machine learning, systems, and quant crypto trading." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/og-image.png" />
    <meta name="theme-color" content="#0b0b0f" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: ["class"],
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "ui-sans-serif", "system-ui", "-apple-system", "Segoe UI", "Roboto", "Arial", "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"],
            },
            colors: {
              base: {50: "#fafafa",100: "#f4f4f5",200: "#e4e4e7",300: "#d4d4d8",400: "#a1a1aa",500: "#71717a",600: "#52525b",700: "#3f3f46",800: "#27272a",900: "#18181b",950: "#0b0b0f"},
              primary: { DEFAULT: "#4f46e5" },
            },
            dropShadow: { glow: "0 0 24px rgba(99,102,241,.35)" },
            boxShadow: { soft: "0 10px 30px rgba(0,0,0,.15)", glass: "inset 0 1px 0 rgba(255,255,255,.08), 0 8px 30px rgba(2,6,23,.35)" },
            backdropBlur: { xs: "2px" },
          },
        },
      };
    </script>

    <style>
      [data-reveal] { opacity: 0; transform: translateY(8px); transition: opacity .8s ease, transform .8s ease; }
      [data-reveal].visible { opacity: 1; transform: translateY(0); }
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      .status-dot { display:inline-block; width:8px; height:8px; border-radius:9999px; margin-right:8px; }
    </style>
  </head>
  <body class="bg-base-950 text-base-100 font-sans antialiased selection:bg-primary/20 selection:text-white">
    <!-- Backdrop gradient + subtle grid -->
    <div aria-hidden="true" class="fixed inset-0 -z-10">
      <div class="absolute inset-0 bg-[radial-gradient(1200px_circle_at_20%_0%,rgba(79,70,229,.18),transparent_40%),radial-gradient(800px_circle_at_80%_20%,rgba(16,185,129,.12),transparent_35%),radial-gradient(1000px_circle_at_30%_100%,rgba(14,165,233,.12),transparent_40%)]"></div>
      <svg class="absolute inset-0 w-full h-full opacity-[.06]" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
            <path d="M40 0H0V40" fill="none" stroke="white" stroke-width="0.5" />
          </pattern>
        </defs>
        <rect width="100%" height="100%" fill="url(#grid)" />
      </svg>
    </div>

    <!-- Sticky Navigation -->
    <header class="sticky top-0 z-40 backdrop-blur-xs supports-[backdrop-filter]:bg-base-950/60">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="flex h-16 items-center justify-between">
          <a href="#top" class="flex items-center gap-2 group">
            <span class="inline-flex h-8 w-8 items-center justify-center rounded-xl bg-white/5 ring-1 ring-white/10 shadow-glass">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="transition-transform group-hover:scale-110">
                <rect x="3" y="3" width="18" height="18" rx="5" fill="white" fill-opacity="0.06" />
                <path d="M8 16V8h2.9c2 0 3.1 1.1 3.1 2.7 0 1.6-1.2 2.7-3.1 2.7H10v2.6H8Zm2-4.5h.8c.9 0 1.4-.4 1.4-1.1s-.5-1.1-1.4-1.1H10v2.2Z" fill="white" opacity=".9"/>
              </svg>
            </span>
            <span class="text-sm font-medium text-white/80">Joon Song</span>
          </a>
          <nav class="hidden md:flex items-center gap-6 text-sm">
            <a class="hover:text-white/90 text-white/70" href="#about">About</a>
            <a class="hover:text-white/90 text-white/70" href="#quant">My Work</a>
            <a class="hover:text-white/90 text-white/70" href="#chat">Chat</a>
            <a class="hover:text-white/90 text-white/70" href="#clone">My Clone</a>
            <a class="hover:text-white/90 text-white/70" href="#contact">Contact</a>
          </nav>
          <div class="flex items-center gap-2">
            <a href="#contact" class="rounded-xl bg-white/10 hover:bg-white/20 ring-1 ring-white/10 px-3 py-1.5 text-sm font-medium text-white/90 shadow-soft">Get in touch</a>
          </div>
        </div>
      </div>
    </header>

    <!-- Hero -->
    <main id="top" class="relative">
      <section class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pt-16 pb-24 md:pt-20 md:pb-28">
        <div class="grid lg:grid-cols-12 gap-10 items-center">
          <div class="lg:col-span-7" data-reveal>
            <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold tracking-tight leading-[1.08]">
              Building intelligent systems
              <span class="block text-transparent bg-clip-text bg-gradient-to-r from-white via-white to-white/40">with a focus on AI and Quant.</span>
            </h1>
            <p class="mt-6 text-lg text-white/70 max-w-2xl">
              I'm <span class="font-semibold text-white">Joon Song</span> — a software engineer working across ML, Backend systems, and Quant Trading.
              I like shipping things that feel simple on the surface and solid underneath.
            </p>
            <div class="mt-8 flex flex-wrap gap-3">
              <a href="#about" class="inline-flex items-center gap-2 rounded-2xl px-5 py-3 text-base font-semibold ring-1 ring-white/10 bg-white/10 hover:bg-white/20 shadow-glass">
                <span>About me</span>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 12h12M12 6l6 6-6 6" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </a>
              <a href="#quant" class="inline-flex items-center gap-2 rounded-2xl px-5 py-3 text-base font-semibold ring-1 ring-white/10 hover:ring-white/20">
                <span>See my approach</span>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 5v14M5 12h14" stroke="white" stroke-width="1.5" stroke-linecap="round"/></svg>
              </a>
            </div>
          </div>
          <div class="lg:col-span-5" data-reveal>
            <div class="relative">
              <div class="absolute -inset-3 rounded-3xl bg-gradient-to-br from-white/20 via-white/5 to-transparent blur-2xl opacity-60"></div>
              <div class="relative rounded-3xl ring-1 ring-white/10 bg-white/5 p-2 shadow-glass">
                <video class="rounded-2xl w-full" autoplay muted playsinline loop poster="https://images.unsplash.com/photo-1518779578993-ec3579fee39f?q=80&w=1400&auto=format&fit=crop" aria-label="Demo reel">
                  <source src="https://cdn.coverr.co/videos/coverr-typing-on-a-laptop-1669/1080p.mp4" type="video/mp4" />
                </video>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- About -->
      <section id="about" class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-16">
        <div class="grid lg:grid-cols-12 gap-10 items-start">
          <div class="lg:col-span-5" data-reveal>
            <img alt="Portrait" src="https://images.unsplash.com/photo-1544006659-f0b21884ce1d?q=80&w=1200&auto=format&fit=crop" class="rounded-3xl ring-1 ring-white/10 shadow-glass" />
          </div>
          <div class="lg:col-span-7" data-reveal>
            <h2 class="text-3xl sm:text-4xl font-bold tracking-tight">About me</h2>
            <p class="mt-4 text-white/70">Engineer with experience across ML, systems, and product. Previously worked on computer vision systems, ML trading strategies, and modern web apps. Currently focusing on robust, AI data‑driven trading and scalable serving.</p>
            <ul class="mt-6 grid sm:grid-cols-2 gap-3 text-white/80 text-sm">
              <li class="rounded-xl bg-white/5 ring-1 ring-white/10 px-4 py-3">Python, PyTorch, C/C++, x86, System Verilog</li>
              <li class="rounded-xl bg-white/5 ring-1 ring-white/10 px-4 py-3">Typescript, Next.js, MongoDB, AWS</li>
              <li class="rounded-xl bg-white/5 ring-1 ring-white/10 px-4 py-3">OpenCV, FastAPI, CUDA</li>
              <li class="rounded-xl bg-white/5 ring-1 ring-white/10 px-4 py-3">GCP, SQL, Linux</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Quant Crypto Trading (Biggest Interest) -->
      <section id="quant" class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-16">
        <div class="max-w-2xl" data-reveal>
          <h2 class="text-3xl sm:text-4xl font-bold tracking-tight">Quant crypto trading</h2>
          <p class="mt-3 text-white/70">Researching and deploying systematic strategies with risk controls and live monitoring. I use ML models with engineered features and strict execution rules.</p>
        </div>
        <div class="mt-8 grid md:grid-cols-3 gap-4" data-reveal>
          <div class="rounded-2xl ring-1 ring-white/10 bg-white/5 p-6">
            <div class="text-2xl font-extrabold">15m</div>
            <div class="text-white/60 text-sm mt-1">Signal cadence</div>
          </div>
          <div class="rounded-2xl ring-1 ring-white/10 bg-white/5 p-6">
            <div class="text-2xl font-extrabold">Ensemble</div>
            <div class="text-white/60 text-sm mt-1">LR • RF • XGB</div>
          </div>
          <div class="rounded-2xl ring-1 ring-white/10 bg-white/5 p-6">
            <div class="text-2xl font-extrabold">Risk first</div>
            <div class="text-white/60 text-sm mt-1">Stops • sizing • cooldowns</div>
          </div>
        </div>
        <div class="mt-8 rounded-3xl ring-1 ring-white/10 bg-white/5 p-6" data-reveal>
          <h3 class="font-semibold">How it works (brief)</h3>
          <ol class="mt-3 space-y-2 text-sm text-white/80 list-decimal list-inside">
            <li>Ingest OHLCV via exchange API and compute technical & statistical factors.</li>
            <li>Generate predictions with an ensemble and vote/threshold for entries.</li>
            <li>Execute with slippage assumptions, risk limits, and post‑trade logging.</li>
          </ol>
          <div class="mt-4 flex flex-wrap gap-2 text-xs text-white/60">
            <span class="rounded-full bg-white/5 px-3 py-1 ring-1 ring-white/10">Upbit API</span>
            <span class="rounded-full bg-white/5 px-3 py-1 ring-1 ring-white/10">Backtesting</span>
            <span class="rounded-full bg-white/5 px-3 py-1 ring-1 ring-white/10">Monitoring</span>
          </div>
        </div>
      </section>

      <!-- Chatbot (Interactive, local demo) -->
      <section id="chat" class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-16">
        <div class="max-w-2xl" data-reveal>
          <h2 class="text-3xl sm:text-4xl font-bold tracking-tight">Chat with me (demo)</h2>
          <p class="mt-3 text-white/70">A small client‑side chatbot that answers basic questions about me and my trading approach. No data leaves your browser.</p>
        </div>
        <div class="mt-8 grid lg:grid-cols-2 gap-6" data-reveal>
          <div class="rounded-3xl ring-1 ring-white/10 bg-white/5 p-0 overflow-hidden shadow-glass">
            <div class="px-4 py-3 border-b border-white/10 flex items-center justify-between">
              <div class="text-sm font-medium">Assistant</div>
              <button id="clearChat" class="text-xs rounded-lg px-2 py-1 ring-1 ring-white/10 hover:bg-white/10">Clear</button>
            </div>
            <div id="chatLog" class="h-72 overflow-y-auto p-4 space-y-3 text-sm no-scrollbar">
              <div class="flex gap-3">
                <div class="shrink-0 h-7 w-7 rounded-full bg-white/10 ring-1 ring-white/10"></div>
                <div class="max-w-[80%] rounded-2xl bg-white/10 ring-1 ring-white/10 px-3 py-2">Hi! Ask me about my background or quant trading approach.</div>
              </div>
            </div>
            <form id="chatForm" class="p-3 border-t border-white/10 flex items-center gap-2">
              <input id="chatInput" class="flex-1 rounded-xl bg-white/10 ring-1 ring-white/10 px-3 py-2 placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-white/30" placeholder="Type a message… (e.g., What models do you use?)" required />
              <button class="rounded-xl bg-white/10 hover:bg-white/20 ring-1 ring-white/10 px-4 py-2 text-sm">Send</button>
            </form>
          </div>
          <div class="rounded-3xl ring-1 ring-white/10 bg-white/5 p-6">
            <h3 class="font-semibold">What it can answer</h3>
            <ul class="mt-3 space-y-2 text-sm text-white/80">
              <li>"What do you trade on?"</li>
              <li>"How does your ensemble work?"</li>
              <li>"What tools/stack do you use?"</li>
              <li>"How can I contact you?"</li>
            </ul>
            <p class="mt-4 text-xs text-white/50">Note: this is a static demo with simple rules.</p>
          </div>
        </div>
      </section>

      <!-- Clone LLM (Backend‑connected) -->
      <section id="clone" class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-16">
        <div class="max-w-2xl" data-reveal>
          <div class="flex items-center gap-3">
            <h2 class="text-3xl sm:text-4xl font-bold tracking-tight">Talk to my clone LLM</h2>
            <span id="cloneStatus" class="text-xs px-2 py-1 rounded-full ring-1 ring-white/10 bg-white/5 text-white/70 flex items-center gap-2">
              <span id="cloneDot" class="status-dot bg-red-400/80"></span>
              <span id="cloneLabel">Checking…</span>
            </span>
          </div>
          <p class="mt-3 text-white/70">This section connects to my backend LLM. It's not always on to save costs. When the server is off, you'll see a friendly heads‑up. When it's on, you can chat in real time.</p>
        </div>

        <!-- Offline notice -->
        <div id="cloneOffline" class="mt-8 rounded-3xl ring-1 ring-white/10 bg-white/5 p-6 hidden" data-reveal>
          <h3 class="font-semibold">Server is sleeping 💤</h3>
          <p class="mt-2 text-white/70">Come back later to chat with me, or ping me and I'll spin it up. You can also try refreshing in a bit.</p>
          <div class="mt-4 flex items-center gap-3">
            <button id="retryCheck" class="rounded-xl bg-white/10 hover:bg-white/20 ring-1 ring-white/10 px-4 py-2 text-sm">Retry</button>
            <a href="#contact" class="text-sm underline text-white/80">Contact me</a>
          </div>
        </div>

        <!-- Online chat UI -->
        <div id="cloneOnline" class="mt-8 grid lg:grid-cols-2 gap-6 hidden" data-reveal>
          <div class="rounded-3xl ring-1 ring-white/10 bg-white/5 p-0 overflow-hidden shadow-glass">
            <div class="px-4 py-3 border-b border-white/10 text-sm font-medium flex items-center justify-between">
              <span>My Clone LLM</span>
              <button id="clearClone" class="text-xs rounded-lg px-2 py-1 ring-1 ring-white/10 hover:bg-white/10">Clear</button>
            </div>
            <div id="cloneLog" class="h-72 overflow-y-auto p-4 space-y-3 text-sm no-scrollbar"></div>
            <form id="cloneForm" class="p-3 border-t border-white/10 flex items-center gap-2">
              <input id="cloneInput" class="flex-1 rounded-xl bg-white/10 ring-1 ring-white/10 px-3 py-2 placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-white/30" placeholder="Ask me anything…" required />
              <button class="rounded-xl bg-white/10 hover:bg-white/20 ring-1 ring-white/10 px-4 py-2 text-sm">Send</button>
            </form>
          </div>
          <div class="rounded-3xl ring-1 ring-white/10 bg-white/5 p-6">
            <h3 class="font-semibold">API details</h3>
            <ul class="mt-3 space-y-2 text-sm text-white/80">
              <li><code>GET /health</code> → 200 OK when online</li>
              <li><code>POST /chat</code> → <code>{ reply: string }</code> (non‑streaming, simple)</li>
            </ul>
            <p class="mt-4 text-xs text-white/50">Configure your endpoint in the script at the bottom of this file. CORS must allow this origin on GitHub Pages.</p>
          </div>
        </div>
      </section>

      <!-- Contact -->
      <section id="contact" class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-16">
        <div class="max-w-2xl" data-reveal>
          <h2 class="text-3xl sm:text-4xl font-bold tracking-tight">Get in touch</h2>
          <p class="mt-3 text-white/70">Open to roles in ML/Systems/Platform and trading collaborations.</p>
        </div>
        <div class="mt-8 grid lg:grid-cols-2 gap-6" data-reveal>
          <form class="rounded-3xl ring-1 ring-white/10 bg-white/5 p-6">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <label class="block">
                <span class="text-sm text-white/70">Name</span>
                <input class="mt-1 w-full rounded-xl bg-white/10 ring-1 ring-white/10 px-3 py-2 placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-white/30" placeholder="Ada Lovelace" required />
              </label>
              <label class="block">
                <span class="text-sm text-white/70">Email</span>
                <input type="email" class="mt-1 w-full rounded-xl bg-white/10 ring-1 ring-white/10 px-3 py-2 placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-white/30" placeholder="you@example.com" required />
              </label>
            </div>
            <label class="block mt-4">
              <span class="text-sm text-white/70">Message</span>
              <textarea class="mt-1 w-full rounded- xl bg-white/10 ring-1 ring-white/10 px-3 py-2 h-28 placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-white/30" placeholder="Tell me about your project…" required></textarea>
            </label>
            <div class="mt-6 flex items-center gap-3">
              <a href="mailto:your.email@example.com" class="inline-flex items-center gap-2 rounded-2xl px-5 py-3 text-base font-semibold ring-1 ring-white/10 bg-white/10 hover:bg-white/20 shadow-glass">Send via email</a>
              <span class="text-xs text-white/50">This form is static. Link goes to your email.</span>
            </div>
          </form>

          <div class="rounded-3xl ring-1 ring-white/10 bg-white/5 p-6">
            <h3 class="text-lg font-semibold">Elsewhere</h3>
            <ul class="mt-4 space-y-3 text-white/80">
              <li><a class="hover:underline" href="https://github.com/joonhsong" target="_blank" rel="noreferrer">GitHub</a></li>
              <li><a class="hover:underline" href="https://www.linkedin.com/in/joonhyuk-song-946082233" target="_blank" rel="noreferrer">LinkedIn</a></li>
              <!-- <li><a class="hover:underline" href="https://x.com/your-username" target="_blank" rel="noreferrer">X (Twitter)</a></li> -->
            </ul>
            <div class="mt-8 text-sm text-white/60">
              <p>Based in Seoul • Available for full‑time & select freelance</p>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="border-t border-white/10">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10 flex flex-col md:flex-row items-center justify-between gap-4 text-white/60 text-sm">
        <p>© <span id="year"></span> Joon Song. All rights reserved.</p>
        <div class="flex items-center gap-4">
          <a href="#top" class="hover:text-white">Back to top</a>
        </div>
      </div>
    </footer>

    <script>
      // Current year
      document.getElementById('year').textContent = new Date().getFullYear();

      // IntersectionObserver reveal animations
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (!prefersReduced) {
        const observer = new IntersectionObserver(entries => {
          entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
        }, { threshold: 0.15 });
        document.querySelectorAll('[data-reveal]').forEach(el => observer.observe(el));
      } else {
        document.querySelectorAll('[data-reveal]').forEach(el => el.classList.add('visible'));
      }

      // Tiny in‑browser chatbot (rule‑based demo)
      const chatLog = document.getElementById('chatLog');
      const chatForm = document.getElementById('chatForm');
      const chatInput = document.getElementById('chatInput');
      const clearBtn = document.getElementById('clearChat');

      function addMsg(text, role = 'bot') {
        const row = document.createElement('div');
        row.className = 'flex gap-3';
        const avatar = document.createElement('div');
        avatar.className = 'shrink-0 h-7 w-7 rounded-full ' + (role === 'bot' ? 'bg-white/10 ring-1 ring-white/10' : 'bg-white/20 ring-1 ring-white/20');
        const bubble = document.createElement('div');
        bubble.className = 'max-w-[80%] rounded-2xl px-3 py-2 ring-1 ' + (role === 'bot' ? 'bg-white/10 ring-white/10' : 'bg-white/20 ring-white/20 text-white');
        bubble.textContent = text;
        row.appendChild(avatar); row.appendChild(bubble);
        chatLog.appendChild(row);
        chatLog.scrollTop = chatLog.scrollHeight;
      }

      function reply(u) {
        const s = u.toLowerCase();
        if (/(hello|hi|hey)/.test(s)) return "Hey! I'm Joon. Ask about my background or quant trading approach.";
        if (/background|about/.test(s)) return "ML/systems engineer; built smart‑factory CV (TTA), trading bots on Upbit, and clean web apps. Based in Seoul.";
        if (/trade|strategy|model|ensemble|quant/.test(s)) return "I trade on 15‑minute bars using an ensemble (LogReg, RandomForest, XGBoost). Entries require vote threshold; exits via stops/cooldowns.";
        if (/stack|tools|tech/.test(s)) return "Python, PyTorch, XGBoost, FastAPI; TS/Next.js/MongoDB; GCP/SQL/Linux.";
        if (/contact|email|reach/.test(s)) return "Best way: email — replace the mailto link in the Contact section with your address.";
        return "This is a lightweight demo that runs entirely in your browser. I can answer basics about me and my trading approach.";
      }

      chatForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const text = chatInput.value.trim();
        if (!text) return;
        addMsg(text, 'user');
        chatInput.value = '';
        const thinking = document.createElement('div');
        thinking.className = 'flex gap-3';
        thinking.innerHTML = '<div class="shrink-0 h-7 w-7 rounded-full bg-white/10 ring-1 ring-white/10"></div><div class="max-w-[80%] rounded-2xl bg-white/10 ring-1 ring-white/10 px-3 py-2 text-white/70">…</div>';
        chatLog.appendChild(thinking); chatLog.scrollTop = chatLog.scrollHeight;
        setTimeout(() => { chatLog.removeChild(thinking); addMsg(reply(text)); }, 450);
      });

      clearBtn.addEventListener('click', () => { chatLog.innerHTML = '';
        addMsg('Hi! Ask me about my background or quant trading approach.');
      });

      // ==== Clone LLM online/offline detection + chat ====
      const API_BASE = 'https://your-llm-backend.example.com'; // <-- CHANGE ME
      const HEALTH_PATH = '/health';
      const CHAT_PATH = '/chat';
      const HEALTH_TIMEOUT_MS = 3000; // Short timeout so the UI feels snappy
      const RECHECK_INTERVAL_MS = 30000; // Re-check every 30s

      const cloneStatus = document.getElementById('cloneStatus');
      const cloneDot = document.getElementById('cloneDot');
      const cloneLabel = document.getElementById('cloneLabel');
      const cloneOffline = document.getElementById('cloneOffline');
      const retryCheck = document.getElementById('retryCheck');
      const cloneOnline = document.getElementById('cloneOnline');
      const cloneLog = document.getElementById('cloneLog');
      const cloneForm = document.getElementById('cloneForm');
      const cloneInput = document.getElementById('cloneInput');
      const clearClone = document.getElementById('clearClone');

      function setCloneStatus(online) {
        if (online) {
          cloneDot.className = 'status-dot bg-emerald-400/90';
          cloneLabel.textContent = 'Online';
          cloneOffline.classList.add('hidden');
          cloneOnline.classList.remove('hidden');
        } else {
          cloneDot.className = 'status-dot bg-red-400/80';
          cloneLabel.textContent = 'Offline';
          cloneOnline.classList.add('hidden');
          cloneOffline.classList.remove('hidden');
        }
      }

      async function checkServer() {
        cloneLabel.textContent = 'Checking…';
        try {
          const controller = new AbortController();
          const id = setTimeout(() => controller.abort(), HEALTH_TIMEOUT_MS);
          const res = await fetch(API_BASE + HEALTH_PATH, { signal: controller.signal, cache: 'no-store' });
          clearTimeout(id);
          setCloneStatus(res.ok);
        } catch (e) {
          setCloneStatus(false);
        }
      }

      function addCloneMsg(text, role='bot') {
        const row = document.createElement('div');
        row.className = 'flex gap-3';
        const avatar = document.createElement('div');
        avatar.className = 'shrink-0 h-7 w-7 rounded-full ' + (role === 'bot' ? 'bg-white/10 ring-1 ring-white/10' : 'bg-white/20 ring-1 ring-white/20');
        const bubble = document.createElement('div');
        bubble.className = 'max-w-[80%] rounded-2xl px-3 py-2 ring-1 ' + (role === 'bot' ? 'bg-white/10 ring-white/10' : 'bg-white/20 ring-white/20 text-white');
        bubble.textContent = text;
        row.appendChild(avatar); row.appendChild(bubble);
        cloneLog.appendChild(row);
        cloneLog.scrollTop = cloneLog.scrollHeight;
      }

      cloneForm?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const text = cloneInput.value.trim();
        if (!text) return;
        addCloneMsg(text, 'user');
        cloneInput.value = '';
        const thinking = document.createElement('div');
        thinking.className = 'flex gap-3';
        thinking.innerHTML = '<div class="shrink-0 h-7 w-7 rounded-full bg-white/10 ring-1 ring-white/10"></div><div class="max-w-[80%] rounded-2xl bg-white/10 ring-1 ring-white/10 px-3 py-2 text-white/70">…</div>';
        cloneLog.appendChild(thinking); cloneLog.scrollTop = cloneLog.scrollHeight;
        try {
          const res = await fetch(API_BASE + CHAT_PATH, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: text })
          });
          if (!res.ok) throw new Error('Bad response');
          const data = await res.json();
          cloneLog.removeChild(thinking);
          addCloneMsg(data.reply || '[No reply field returned]');
        } catch (err) {
          cloneLog.removeChild(thinking);
          addCloneMsg('Server went offline or error occurred. Please try again later.');
          setCloneStatus(false); // flip UI to offline if we hit an error mid-chat
        }
      });

      clearClone?.addEventListener('click', () => { cloneLog.innerHTML = ''; });
      retryCheck?.addEventListener('click', checkServer);

      // Kick off detection and re-check periodically
      checkServer();
      setInterval(checkServer, RECHECK_INTERVAL_MS);
    </script>
  </body>
</html>
